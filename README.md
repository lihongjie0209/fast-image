# Fast Image - é«˜æ€§èƒ½å›¾åƒå‹ç¼©åº“

![Rust](https://img.shields.io/badge/rust-%23000000.svg?style=for-the-badge&logo=rust&logoColor=white)
![License](https://img.shields.io/badge/license-MIT-blue.svg?style=for-the-badge)

ä¸€ä¸ªç”¨ Rust ç¼–å†™çš„é«˜æ€§èƒ½å›¾åƒå‹ç¼©åº“ï¼Œæ”¯æŒ PNG å’Œ JPEG æ ¼å¼çš„æ™ºèƒ½å‹ç¼©ã€‚

## ğŸ—ï¸ è‡ªåŠ¨åŒ–æ„å»º

æœ¬é¡¹ç›®ä½¿ç”¨ GitHub Actions è‡ªåŠ¨æ„å»ºå¤šå¹³å°åŸç”Ÿåº“ï¼š

### ğŸ¯ æ”¯æŒå¹³å°ï¼ˆè‡ªåŠ¨æ„å»ºï¼‰
- **Windows x64** (`fast_image-windows-x86_64.dll`)
- **Windows ARM64** (`fast_image-windows-aarch64.dll`)  
- **Linux x64** (`libfast_image-linux-x86_64.so`)
- **Linux ARM64** (`libfast_image-linux-aarch64.so`)
- **macOS Intel** (`libfast_image-macos-x86_64.dylib`)
- **macOS Apple Silicon** (`libfast_image-macos-aarch64.dylib`)

### ğŸ“¦ è·å–é¢„æ„å»ºåº“

1. **ä» GitHub Releases**ï¼ˆæ¨èï¼‰:
   - è®¿é—® [Releases é¡µé¢](https://github.com/lihongjie0209/fast-image/releases)
   - ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„æ‰€æœ‰å¹³å°åº“
   - æˆ–ä¸‹è½½ç‰¹å®šå¹³å°çš„å•ä¸ªåº“æ–‡ä»¶

2. **æ‰‹åŠ¨è§¦å‘æ„å»º**:
   ```bash
   # åˆ›å»ºæ–°ç‰ˆæœ¬å‘å¸ƒ
   ./release.sh           # Linux/macOS
   ./release.bat          # Windows
   
   # æˆ–æ¨é€ç‰ˆæœ¬æ ‡ç­¾
   git tag v0.2.1
   git push origin v0.2.1
   ```

3. **GitHub Actions æ„å»ºäº§ç‰©**:
   - æ¯æ¬¡æäº¤éƒ½ä¼šæ„å»ºæ‰€æœ‰å¹³å°
   - å¯ä» Actions æ ‡ç­¾é¡µä¸‹è½½æµ‹è¯•ç‰ˆæœ¬

## âœ¨ ç‰¹æ€§

- ğŸš€ **é«˜æ€§èƒ½å‹ç¼©**: ä½¿ç”¨ä¸šç•Œé¢†å…ˆçš„å‹ç¼©ç®—æ³•
- ğŸ¯ **æ™ºèƒ½æ ¼å¼æ£€æµ‹**: è‡ªåŠ¨è¯†åˆ«å›¾ç‰‡æ ¼å¼
- âš™ï¸ **è´¨é‡æ§åˆ¶**: æ”¯æŒ0-100çš„è´¨é‡å‚æ•°è°ƒèŠ‚
- ğŸ“Š **æ˜¾è‘—å‹ç¼©æ•ˆæœ**: PNGæœ€é«˜66.4%å‹ç¼©ç‡ï¼ŒJPEGæœ€é«˜95.5%å‹ç¼©ç‡
- ğŸ› ï¸ **æ˜“äºä½¿ç”¨**: ç®€æ´çš„APIè®¾è®¡

## ğŸ”§ æŠ€æœ¯æ ˆ

| ç»„ä»¶ | åº“ | ç”¨é€” |
|------|----|----- |
| PNGå‹ç¼© | `imagequant` + `png` | é¢œè‰²é‡åŒ– + ç´¢å¼•è‰²å½©PNG |
| JPEGå‹ç¼© | `mozjpeg` | é«˜è´¨é‡JPEGå‹ç¼© |
| å›¾åƒå¤„ç† | `image` | é€šç”¨å›¾åƒæ“ä½œ |

## ğŸ“¦ å®‰è£…

å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°ä½ çš„ `Cargo.toml`:

```toml
[dependencies]
fast-image = "0.1.0"
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

```rust
use fast_image::*;
use std::fs;

fn main() -> Result<(), Box<dyn std::error::Error>> {
    // è¯»å–å›¾ç‰‡æ–‡ä»¶
    let image_data = fs::read("input.png")?;
    
    // å‹ç¼©å›¾ç‰‡ (è´¨é‡: 0-100)
    let compressed = do_png_compression(&image_data, 70)?;
    
    // ä¿å­˜å‹ç¼©åçš„å›¾ç‰‡
    fs::write("output.png", compressed)?;
    
    Ok(())
}
```

## ğŸ“Š å‹ç¼©æ•ˆæœå¯¹æ¯”

> ğŸ“‹ **è¯¦ç»†ç»“æœ**: æŸ¥çœ‹ [å‹ç¼©ç»“æœå¯¹æ¯”æ–‡æ¡£](COMPRESSION_RESULTS.md) äº†è§£å®Œæ•´çš„å›¾ç‰‡å¯¹æ¯”å’Œåˆ†æ  
> âš¡ **æ€§èƒ½åˆ†æ**: æŸ¥çœ‹ [æ€§èƒ½åˆ†ææŠ¥å‘Š](PERFORMANCE_ANALYSIS.md) äº†è§£æ•°æ®è½¬æ¢å¼€é”€å’Œä¼˜åŒ–å»ºè®®

æˆ‘ä»¬ä½¿ç”¨5MBçš„æµ‹è¯•å›¾ç‰‡è¿›è¡Œäº†å…¨é¢çš„å‹ç¼©æµ‹è¯•ï¼Œç»“æœå¦‚ä¸‹ï¼š

### PNG å‹ç¼©ç»“æœ

ä½¿ç”¨ `imagequant` é¢œè‰²é‡åŒ– + PNG ç´¢å¼•è‰²å½©æ¨¡å¼ï¼š

| è´¨é‡ç­‰çº§ | æ–‡ä»¶å¤§å° | å‹ç¼©ç‡ | æ–‡ä»¶å¤§å°å‡å°‘ | é€‚ç”¨åœºæ™¯ |
|---------|----------|--------|-------------|----------|
| **åŸå§‹** | 5.01MB | - | - | - |
| **30** | 1.68MB | **66.4%** | 3.33MB | æœ€å¤§å‹ç¼© |
| **50** | 1.98MB | **60.4%** | 3.03MB | å¹³è¡¡æ¨¡å¼ |
| **70** | 2.02MB | **59.7%** | 2.99MB | æ ‡å‡†è´¨é‡ |
| **90** | 2.32MB | **53.7%** | 2.69MB | é«˜è´¨é‡ |

### JPEG å‹ç¼©ç»“æœ

ä½¿ç”¨ `mozjpeg` é«˜æ€§èƒ½JPEGå‹ç¼©ï¼š

| è´¨é‡ç­‰çº§ | æ–‡ä»¶å¤§å° | å‹ç¼©ç‡ | æ–‡ä»¶å¤§å°å‡å°‘ | é€‚ç”¨åœºæ™¯ |
|---------|----------|--------|-------------|----------|
| **åŸå§‹** | 5.02MB | - | - | - |
| **30** | 229.50KB | **95.5%** | 4.79MB | ç¼©ç•¥å›¾ |
| **50** | 389.35KB | **92.4%** | 4.63MB | ç½‘é¡µä¼˜åŒ– |
| **70** | 745.89KB | **85.5%** | 4.28MB | æ ‡å‡†è´¨é‡ |
| **90** | 2.58MB | **48.7%** | 2.44MB | é«˜è´¨é‡ |

## ğŸ“ˆ å‹ç¼©æ•ˆæœå¯è§†åŒ–

### æ–‡ä»¶å¤§å°å¯¹æ¯”å›¾

```
åŸå§‹æ–‡ä»¶å¤§å°: 5MB
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PNGå‹ç¼© (è´¨é‡30): â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  66.4%å‡å°‘  â”‚
â”‚ PNGå‹ç¼© (è´¨é‡50): â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  60.4%å‡å°‘  â”‚  
â”‚ PNGå‹ç¼© (è´¨é‡70): â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  59.7%å‡å°‘  â”‚
â”‚ PNGå‹ç¼© (è´¨é‡90): â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  53.7%å‡å°‘  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ JPEGå‹ç¼©(è´¨é‡30): â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘  95.5%å‡å°‘ â”‚
â”‚ JPEGå‹ç¼©(è´¨é‡50): â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  92.4%å‡å°‘ â”‚
â”‚ JPEGå‹ç¼©(è´¨é‡70): â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘  85.5%å‡å°‘ â”‚ 
â”‚ JPEGå‹ç¼©(è´¨é‡90): â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  48.7%å‡å°‘ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ ä½¿ç”¨å»ºè®®

### PNGå‹ç¼©å»ºè®®
- **è´¨é‡ 30-50**: é€‚ç”¨äºéœ€è¦æœ€å¤§å‹ç¼©çš„åœºæ™¯ï¼Œå¯å‡å°‘60-66%æ–‡ä»¶å¤§å°
- **è´¨é‡ 70-90**: é€‚ç”¨äºéœ€è¦ä¿æŒè¾ƒå¥½è´¨é‡çš„åœºæ™¯ï¼Œå¯å‡å°‘54-60%æ–‡ä»¶å¤§å°

### JPEGå‹ç¼©å»ºè®®  
- **è´¨é‡ 30-50**: é€‚ç”¨äºç½‘é¡µç¼©ç•¥å›¾ï¼Œå¯å‡å°‘92-95%æ–‡ä»¶å¤§å°
- **è´¨é‡ 70-90**: é€‚ç”¨äºé«˜è´¨é‡å±•ç¤ºï¼Œå¯å‡å°‘49-86%æ–‡ä»¶å¤§å°

## ğŸ“– API æ–‡æ¡£

### ä¸»è¦å‡½æ•°

```rust
// PNGå‹ç¼©
pub fn do_png_compression(data: &[u8], quality: u8) -> Result<Vec<u8>, String>

// JPEGå‹ç¼©  
pub fn do_jpeg_compression(data: &[u8], quality: u8) -> Result<Vec<u8>, String>

// è‡ªåŠ¨æ ¼å¼æ£€æµ‹
impl ImageType {
    pub fn detect_type(data: &[u8]) -> Option<ImageType>
}

// é€šç”¨å‹ç¼©æ¥å£
impl Compression for ImageType {
    fn compress(data: &[u8], quality: u8) -> Result<Vec<u8>, String>
}
```

### ä½¿ç”¨ç¤ºä¾‹

```rust
use fast_image::*;
use std::fs;

// ç¤ºä¾‹1: PNGå‹ç¼©
fn compress_png() -> Result<(), String> {
    let png_data = fs::read("input.png").map_err(|e| e.to_string())?;
    let compressed = do_png_compression(&png_data, 70)?;
    fs::write("output.png", compressed).map_err(|e| e.to_string())?;
    Ok(())
}

// ç¤ºä¾‹2: JPEGå‹ç¼©
fn compress_jpeg() -> Result<(), String> {
    let jpeg_data = fs::read("input.jpg").map_err(|e| e.to_string())?;
    let compressed = do_jpeg_compression(&jpeg_data, 80)?;
    fs::write("output.jpg", compressed).map_err(|e| e.to_string())?;
    Ok(())
}

// ç¤ºä¾‹3: è‡ªåŠ¨æ£€æµ‹æ ¼å¼å¹¶å‹ç¼©
fn auto_compress() -> Result<(), String> {
    let image_data = fs::read("input.jpg").map_err(|e| e.to_string())?;
    let compressed = ImageType::compress(&image_data, 75)?;
    fs::write("output_compressed", compressed).map_err(|e| e.to_string())?;
    Ok(())
}
```

## ğŸ§ª æµ‹è¯•

è¿è¡Œæµ‹è¯•å¥—ä»¶ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test

# è¿è¡Œå‹ç¼©æµ‹è¯•ï¼ˆå¸¦è¯¦ç»†è¾“å‡ºï¼‰
cargo test --test compression_tests -- --nocapture

# è¿è¡ŒPNGå‹ç¼©æµ‹è¯•
cargo test test_png_compression_with_sample_file -- --nocapture

# è¿è¡ŒJPEGå‹ç¼©æµ‹è¯•  
cargo test test_jpeg_compression_with_sample_file -- --nocapture

# è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•
cargo test --test performance_benchmark -- --nocapture
```

## ğŸš€ æ€§èƒ½åŸºå‡†

åœ¨5MBæµ‹è¯•æ–‡ä»¶ä¸Šçš„æ€§èƒ½è¡¨ç°ï¼š

| æ“ä½œ | å¹³å‡è€—æ—¶ | å†…å­˜ä½¿ç”¨ |
|------|----------|----------|
| PNGå‹ç¼© | ~13ç§’ | ä½ |
| JPEGå‹ç¼© | ~15ç§’ | ä½ |
| æ ¼å¼æ£€æµ‹ | <1ms | æä½ |

## ğŸ”„ ç¤ºä¾‹ç¨‹åº

æŸ¥çœ‹ `examples/` æ–‡ä»¶å¤¹ä¸­çš„ç¤ºä¾‹ï¼š

```bash
# è¿è¡Œå‹ç¼©ç¤ºä¾‹
cargo run --example compress_image
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Pull Request å’Œ Issueï¼

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ”— ç›¸å…³é“¾æ¥

- [imagequant](https://crates.io/crates/imagequant) - PNGé¢œè‰²é‡åŒ–åº“
- [mozjpeg](https://crates.io/crates/mozjpeg) - é«˜æ€§èƒ½JPEGå‹ç¼©åº“  
- [png](https://crates.io/crates/png) - PNGç¼–ç è§£ç åº“
- [image](https://crates.io/crates/image) - Rustå›¾åƒå¤„ç†åº“

---

**Fast Image** - è®©å›¾åƒå‹ç¼©æ›´ç®€å•ã€æ›´é«˜æ•ˆï¼ ğŸš€
